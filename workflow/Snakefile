# Main entrypoint of the workflow.
# Please follow the best practices:
# https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html,
# in particular regarding the standardized folder structure mentioned there.

import pandas as pd
import yaml

# Import configuration files
# params = yaml.load(open("config/params.yml", "r"), Loader=yaml.SafeLoader)
# features = yaml.load(open("config/features.yml", "r"), Loader=yaml.SafeLoader)
samples = pd.read_table("config/samples.tsv", comment="#", dtype="str")


# Generate useful variables
SAMPLES = samples["sample"].drop_duplicates().values.tolist()
SAMPLE_LIB = samples[["sample", "library"]].values.tolist()

# shell.prefix("set -euxo pipefail;")


# Import subworkflows
include: "rules/folders.smk"
include: "rules/common.smk"
include: "rules/raw.smk"
include: "rules/fastqc.smk"
include: "rules/fastp.smk"


# include: rules / "bowtie2.smk"
# include: rules / "gatk.smk"


rule clean:
    conda:
        f"{CONDA}/empty.yml"
    log:
        "clean.log",
    shell:
        "rm -rf results/"


rule all:
    input:
        rules.raw_link.input,
        rules.raw_fastqc.input,
        rules.fastp.input,
